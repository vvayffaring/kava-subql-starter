{"version":3,"file":"models.js","sourceRoot":"","sources":["../../src/project/models.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020-2022 OnFinality Limited authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\nimport {BaseMapping, FileReference} from '@subql/common';\nimport {\n  CustomDataSourceAsset as NearCustomDataSourceAsset,\n  NearBlockFilter,\n  NearBlockHandler,\n  NearTransactionHandler,\n  NearActionFilter,\n  NearCustomHandler,\n  NearDatasourceKind,\n  NearTransactionFilter,\n  NearActionHandler,\n  NearHandlerKind,\n  NearNetworkFilter,\n  NearRuntimeDatasource,\n  NearRuntimeHandler,\n  NearRuntimeHandlerFilter,\n  NearCustomDatasource,\n  ActionType,\n  NearReceiptHandler,\n  NearReceiptFilter,\n} from '@subql/types-near';\nimport BN from 'bn.js';\nimport {plainToClass, Transform, Type} from 'class-transformer';\nimport {\n  ArrayMaxSize,\n  IsArray,\n  IsBoolean,\n  IsEnum,\n  IsInt,\n  IsOptional,\n  IsString,\n  IsObject,\n  ValidateNested,\n  registerDecorator,\n  ValidationArguments,\n  ValidationOptions,\n  Min,\n  ValidateIf,\n} from 'class-validator';\n\nexport class BlockFilter implements NearBlockFilter {\n  @IsOptional()\n  @IsArray()\n  @ArrayMaxSize(2)\n  specVersion?: [number, number];\n  @IsOptional()\n  @IsInt()\n  modulo?: number;\n  @IsOptional()\n  @IsString()\n  timestamp?: string;\n}\n\nexport class TransactionFilter extends BlockFilter implements NearTransactionFilter {\n  @IsOptional()\n  @IsString()\n  sender?: string;\n  @IsOptional()\n  @IsString()\n  receiver?: string;\n}\n\nexport function IsActionType(validationOptions?: ValidationOptions) {\n  return function (object: object, propertyName: string) {\n    registerDecorator({\n      name: 'isActionType',\n      target: object.constructor,\n      propertyName: propertyName,\n      constraints: [],\n      options: validationOptions,\n      validator: {\n        validate(value: any, args: ValidationArguments) {\n          return Object.values(ActionType).includes(value);\n        },\n      },\n    });\n  };\n}\n\nexport class ReceiptFilter extends TransactionFilter implements NearReceiptFilter {\n  @IsOptional()\n  @IsString()\n  signer?: string;\n}\n\nexport class ActionFilter extends ReceiptFilter implements NearActionFilter {\n  @IsString()\n  @IsActionType()\n  type: ActionType;\n\n  @IsString()\n  @IsOptional()\n  @ValidateIf((o: ActionFilter) => {\n    return o.type === ActionType.FunctionCall;\n  })\n  methodName?: string;\n\n  @IsString()\n  @IsOptional()\n  @ValidateIf((o: ActionFilter) => {\n    return o.type === ActionType.FunctionCall;\n  })\n  args?: string;\n\n  @IsString()\n  @IsOptional()\n  @ValidateIf((o: ActionFilter) => {\n    return o.type === ActionType.Stake || o.type === ActionType.AddKey || o.type === ActionType.DeleteKey;\n  })\n  publicKey?: string;\n\n  @IsString()\n  @IsOptional()\n  @ValidateIf((o: ActionFilter) => {\n    return o.type === ActionType.AddKey;\n  })\n  accessKey?: string;\n\n  @IsString()\n  @IsOptional()\n  @ValidateIf((o: ActionFilter) => {\n    return o.type === ActionType.DeleteAccount;\n  })\n  beneficiaryId?: string;\n}\n\nexport class BlockHandler implements NearBlockHandler {\n  @IsOptional()\n  @ValidateNested()\n  @Type(() => BlockFilter)\n  filter?: NearBlockFilter;\n  @IsEnum(NearHandlerKind, {groups: [NearHandlerKind.Block]})\n  kind: NearHandlerKind.Block;\n  @IsString()\n  handler: string;\n}\n\nexport class TransactionHandler implements NearTransactionHandler {\n  @IsOptional()\n  @ValidateNested()\n  @Type(() => TransactionFilter)\n  filter?: NearTransactionFilter;\n  @IsEnum(NearHandlerKind, {groups: [NearHandlerKind.Transaction]})\n  kind: NearHandlerKind.Transaction;\n  @IsString()\n  handler: string;\n}\n\nexport class ActionHandler implements NearActionHandler {\n  @IsOptional()\n  @ValidateNested()\n  @Type(() => ActionFilter)\n  filter?: NearActionFilter;\n  @IsEnum(NearHandlerKind, {groups: [NearHandlerKind.Action]})\n  kind: NearHandlerKind.Action;\n  @IsString()\n  handler: string;\n}\n\nexport class ReceiptHandler implements NearReceiptHandler {\n  @IsOptional()\n  @ValidateNested()\n  @Type(() => ReceiptFilter)\n  filter?: NearReceiptFilter;\n  @IsEnum(NearHandlerKind, {groups: [NearHandlerKind.Receipt]})\n  kind: NearHandlerKind.Receipt;\n  @IsString()\n  handler: string;\n}\n\nexport class CustomHandler implements NearCustomHandler {\n  @IsString()\n  kind: string;\n  @IsString()\n  handler: string;\n  @IsObject()\n  @IsOptional()\n  filter?: Record<string, unknown>;\n}\n\nexport class RuntimeMapping implements BaseMapping<NearRuntimeHandlerFilter, NearRuntimeHandler> {\n  @Transform((params) => {\n    const handlers: NearRuntimeHandler[] = params.value;\n    return handlers.map((handler) => {\n      switch (handler.kind) {\n        case NearHandlerKind.Receipt:\n          return plainToClass(ReceiptHandler, handler);\n        case NearHandlerKind.Action:\n          return plainToClass(ActionHandler, handler);\n        case NearHandlerKind.Transaction:\n          return plainToClass(TransactionHandler, handler);\n        case NearHandlerKind.Block:\n          return plainToClass(BlockHandler, handler);\n        default:\n          throw new Error(`handler ${(handler as any).kind} not supported`);\n      }\n    });\n  })\n  @IsArray()\n  @ValidateNested()\n  handlers: NearRuntimeHandler[];\n  @IsString()\n  file: string;\n}\n\nexport class CustomMapping implements BaseMapping<Record<string, unknown>, NearCustomHandler> {\n  @IsArray()\n  @Type(() => CustomHandler)\n  @ValidateNested()\n  handlers: CustomHandler[];\n  @IsString()\n  file: string;\n}\n\nexport class SubqlNetworkFilterImpl implements NearNetworkFilter {\n  @IsString()\n  @IsOptional()\n  specName?: string;\n}\n\nexport class RuntimeDataSourceBase implements NearRuntimeDatasource {\n  @IsEnum(NearDatasourceKind, {groups: [NearDatasourceKind.Runtime]})\n  kind: NearDatasourceKind.Runtime;\n  @Type(() => RuntimeMapping)\n  @ValidateNested()\n  mapping: RuntimeMapping;\n  //must be greater than genesis block\n  @Min(9820210)\n  @IsOptional()\n  @IsInt()\n  startBlock?: number;\n  @IsOptional()\n  @ValidateNested()\n  @Type(() => SubqlNetworkFilterImpl)\n  filter?: NearNetworkFilter;\n}\n\nexport class FileReferenceImpl implements FileReference {\n  @IsString()\n  file: string;\n}\n\nexport class CustomDataSourceBase<K extends string, T extends NearNetworkFilter, M extends CustomMapping, O = any>\n  implements NearCustomDatasource<K, T, M, O>\n{\n  @IsString()\n  kind: K;\n  @Type(() => CustomMapping)\n  @ValidateNested()\n  mapping: M;\n  @IsOptional()\n  @IsInt()\n  startBlock?: number;\n  @Type(() => FileReferenceImpl)\n  @ValidateNested({each: true})\n  assets: Map<string, NearCustomDataSourceAsset>;\n  @Type(() => FileReferenceImpl)\n  @IsObject()\n  processor: FileReference;\n  @IsOptional()\n  @IsObject()\n  filter?: T;\n}\n"]}